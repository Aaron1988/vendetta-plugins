(function(y,D,A,x){"use strict";const b=4259920+Math.floor(Math.random()*4089)+8;let w={id:"0",state:"untouched",sliderIndex:"0",duration:0,channelId:"0",messageId:"0"};function S(){return w}function s(r){w={...w,...r}}function E(r){const i=Math.floor(r/1e3),e=String(Math.floor(i/60)).padStart(2,"0"),t=String(i%60).padStart(2,"0");return`${e}:${t}`}function u(r,i){let e={channelId:r,messageId:i,userId:"4259920",emoji:{name:"update",id:"4259920"},burst:!1,colors:void 0,messageAuthorId:void 0};x.FluxDispatcher.dispatch({...e,type:"MESSAGE_REACTION_ADD"}),x.FluxDispatcher.dispatch({...e,type:"MESSAGE_REACTION_REMOVE"})}const _={type:"rich",spoiler:"",provider:void 0,author:void 0,rawTitle:void 0,title:void 0,url:void 0,rawDescription:"",description:[{content:"",type:"text"}],thumbnail:void 0,image:void 0,images:void 0,fields:[],footer:void 0,video:void 0,borderLeftColor:-14803166,providerColor:-3880498,headerTextColor:-4867391,bodyTextColor:-2367775,referenceId:void 0,backgroundColor:void 0},N=D.findByName("RowManager"),P=new Set(["mp3","m4a","ogg","wav"]);function B(r,i,e,t,n,a){let o=Buffer.from(n).toString("base64"),f=function(T){let{index:I,content:v}=T;return{type:"link",target:`https://discord.com/channels/${b}/${I}/${i}/${r}/${e}/${o}`,content:[{type:"inlineCode",content:v}]}},l=S(),d=l.id===e,p=d?l.sliderIndex:"0",$=d?l.state==="playing":!1,g=d?l.time?.t:void 0,C=Array.from({length:20}).map(function(T,I){let v="\u25AC";return I.toString()===p&&(v="\u2586"),f({index:I,content:v})}),F=d?[{type:"text",content:l.state+" \u2014 "},{type:"strong",content:[{type:"text",content:E(g??0)}]},{type:"text",content:" / "},{type:"strong",content:[{type:"text",content:E(l.duration)}]},{type:"text",content:`
`}]:[{type:"text",content:`
`}];return{..._,author:{name:t,url:n},description:[{content:[...F,...C,{type:"heading",content:[f($?{index:200,content:"\u0965"}:{index:100,content:"\u25B6"})],level:1}],type:"paragraph"}],footer:{content:a}}}function R(){return A.after("generate",N.prototype,function(r,i){let[e]=r,{message:t}=i;if(!t?.embeds||!t?.attachments?.length)return;let n=[],a=[];t.attachments.forEach(function(o){P.has(o.filename.toLowerCase().split(".").pop())?n.push(B(t.id,t.channelId,o.id,o.filename,o.url,o.size)):a.push(o)}),n.length&&(t.embeds.push(...n),t.attachments=a),t?.reactions?.length&&(t.reactions=t.reactions.filter(function(o){return o.emoji.id!="4259920"}))})}let h=!1;const{DCDSoundManager:c}=x.ReactNative.NativeModules;function O(r){return console.log("Preparing",r),console.log({isAudioPrepared:h}),h&&c.release(4259920),h=!0,new Promise(function(i){return c.prepare(r,"ring_tone",4259920,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i(t)})})}let M=!1;function j(){const r=A.instead("default",D.findByName("safeTransitionTo",!1),function(i,e){let t=i[0].split("/");if(t[2]===b.toString()){let[,,,n,a,o,f,l]=t,d=S();if(d.id!=f){if(M)return new Promise(function(g){return g(void 0)});M=!0;let[p,$]=[d.channelId,d.messageId];s({id:f,state:"loading",sliderIndex:"0",duration:0,messageId:o,channelId:a}),u(p,$),O(Buffer.from(l,"base64").toString("ascii")).then(function(g){let[,{duration:C}]=g;s({state:"playing",duration:C,time:{l:+Date.now(),t:0}}),c.play(4259920),M=!1,u(a,o)})}else n==="200"?(s({state:"paused"}),c.pause(4259920),u(a,o)):n==="100"?(s({state:"playing"}),c.play(4259920),u(a,o)):(console.log("Index",n),console.log(d.duration/20*parseInt(n)),s({state:"playing",sliderIndex:n,time:{l:+Date.now(),t:d.duration/20*parseInt(n)}}),c.setCurrentTime(4259920,d.duration/20*parseInt(n)),u(a,o));return u(a,o),new Promise(function(p){return p(void 0)})}return e(...i)});return function(){r(),h&&c.release(4259920)}}function L(){let r=0,i=setInterval(function(){let e=S();if(e.state!="playing"||!e.time)return;let t=+Date.now()-e.time.l+e.time.t,n=!1;if(r++,r>33&&(r=0),r==33&&(n=!0),t>e.duration){s({state:"untouched",sliderIndex:"0",id:"0"}),u(e.channelId,e.messageId);return}let a=Math.floor(t/e.duration*20).toString(),o=!1;a!=e.sliderIndex&&(o=!0,s({sliderIndex:a})),(n||o)&&(o=!0,s({time:{t,l:+Date.now()}})),o&&u(e.channelId,e.messageId)},1e3/30);return function(){return clearInterval(i)}}let m=[];var k={onLoad:function(){m.push(R()),m.push(j()),m.push(L())},onUnload:function(){for(const r of m)r()}};return y.default=k,Object.defineProperty(y,"__esModule",{value:!0}),y})({},vendetta.metro,vendetta.patcher,vendetta.metro.common);
